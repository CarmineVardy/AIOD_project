\documentclass[journal, a4paper, onecolumn]{IEEEtran}

% some very useful LaTeX packages include:

%\usepackage{cite}      % Written by Donald Arseneau
                        % V1.6 and later of IEEEtran pre-defines the format
                        % of the cite.sty package \cite{} output to follow
                        % that of IEEE. Loading the cite package will
                        % result in citation numbers being automatically
                        % sorted and properly "ranged". i.e.,
                        % [1], [9], [2], [7], [5], [6]
                        % (without using cite.sty)
                        % will become:
                        % [1], [2], [5]--[7], [9] (using cite.sty)
                        % cite.sty's \cite will automatically add leading
                        % space, if needed. Use cite.sty's noadjust option
                        % (cite.sty V3.8 and later) if you want to turn this
                        % off. cite.sty is already installed on most LaTeX
                        % systems. The latest version can be obtained at:
                        % http://www.ctan.org/tex-archive/macros/latex/contrib/supported/cite/

\usepackage{graphicx}   % Written by David Carlisle and Sebastian Rahtz
                        % Required if you want graphics, photos, etc.
                        % graphicx.sty is already installed on most LaTeX
                        % systems. The latest version and documentation can
                        % be obtained at:
                        % http://www.ctan.org/tex-archive/macros/latex/required/graphics/
                        % Another good source of documentation is "Using
                        % Imported Graphics in LaTeX2e" by Keith Reckdahl
                        % which can be found as esplatex.ps and epslatex.pdf
                        % at: http://www.ctan.org/tex-archive/info/

%\usepackage{psfrag}    % Written by Craig Barratt, Michael C. Grant,
                        % and David Carlisle
                        % This package allows you to substitute LaTeX
                        % commands for text in imported EPS graphic files.
                        % In this way, LaTeX symbols can be placed into
                        % graphics that have been generated by other
                        % applications. You must use latex->dvips->ps2pdf
                        % workflow (not direct pdf output from pdflatex) if
                        % you wish to use this capability because it works
                        % via some PostScript tricks. Alternatively, the
                        % graphics could be processed as separate files via
                        % psfrag and dvips, then converted to PDF for
                        % inclusion in the main file which uses pdflatex.
                        % Docs are in "The PSfrag System" by Michael C. Grant
                        % and David Carlisle. There is also some information
                        % about using psfrag in "Using Imported Graphics in
                        % LaTeX2e" by Keith Reckdahl which documents the
                        % graphicx package (see above). The psfrag package
                        % and documentation can be obtained at:
                        % http://www.ctan.org/tex-archive/macros/latex/contrib/supported/psfrag/

%\usepackage{subfigure} % Written by Steven Douglas Cochran
                        % This package makes it easy to put subfigures
                        % in your figures. i.e., "figure 1a and 1b"
                        % Docs are in "Using Imported Graphics in LaTeX2e"
                        % by Keith Reckdahl which also documents the graphicx
                        % package (see above). subfigure.sty is already
                        % installed on most LaTeX systems. The latest version
                        % and documentation can be obtained at:
                        % http://www.ctan.org/tex-archive/macros/latex/contrib/supported/subfigure/

\usepackage{url}        % Written by Donald Arseneau
                        % Provides better support for handling and breaking
                        % URLs. url.sty is already installed on most LaTeX
                        % systems. The latest version can be obtained at:
                        % http://www.ctan.org/tex-archive/macros/latex/contrib/other/misc/
                        % Read the url.sty source comments for usage information.

%\usepackage{stfloats}  % Written by Sigitas Tolusis
                        % Gives LaTeX2e the ability to do double column
                        % floats at the bottom of the page as well as the top.
                        % (e.g., "\begin{figure*}[!b]" is not normally
                        % possible in LaTeX2e). This is an invasive package
                        % which rewrites many portions of the LaTeX2e output
                        % routines. It may not work with other packages that
                        % modify the LaTeX2e output routine and/or with other
                        % versions of LaTeX. The latest version and
                        % documentation can be obtained at:
                        % http://www.ctan.org/tex-archive/macros/latex/contrib/supported/sttools/
                        % Documentation is contained in the stfloats.sty
                        % comments as well as in the presfull.pdf file.
                        % Do not use the stfloats baselinefloat ability as
                        % IEEE does not allow \baselineskip to stretch.
                        % Authors submitting work to the IEEE should note
                        % that IEEE rarely uses double column equations and
                        % that authors should try to avoid such use.
                        % Do not be tempted to use the cuted.sty or
                        % midfloat.sty package (by the same author) as IEEE
                        % does not format its papers in such ways.

\usepackage{amsmath}    % From the American Mathematical Society
                        % A popular package that provides many helpful commands
                        % for dealing with mathematics. Note that the AMSmath
                        % package sets \interdisplaylinepenalty to 10000 thus
                        % preventing page breaks from occurring within multiline
                        % equations. Use:
%\interdisplaylinepenalty=2500
                        % after loading amsmath to restore such page breaks
                        % as IEEEtran.cls normally does. amsmath.sty is already
                        % installed on most LaTeX systems. The latest version
                        % and documentation can be obtained at:
                        % http://www.ctan.org/tex-archive/macros/latex/required/amslatex/math/

% Other popular packages for formatting tables and equations include:

%\usepackage{array}
% Frank Mittelbach's and David Carlisle's array.sty which improves the
% LaTeX2e array and tabular environments to provide better appearances and
% additional user controls. array.sty is already installed on most systems.
% The latest version and documentation can be obtained at:
% http://www.ctan.org/tex-archive/macros/latex/required/tools/

% V1.6 of IEEEtran contains the IEEEeqnarray family of commands that can
% be used to generate multiline equations as well as matrices, tables, etc.

% Also of notable interest:
% Scott Pakin's eqparbox package for creating (automatically sized) equal
% width boxes. Available:
% http://www.ctan.org/tex-archive/macros/latex/contrib/supported/eqparbox/

% *** Do not adjust lengths that control margins, column widths, etc. ***
% *** Do not use packages that alter fonts (such as pslatex).         ***
% There should be no need to do such things with IEEEtran.cls V1.6 and later.

%\usepackage{hyperref}
% To insert hyperlinks in the document

\usepackage{microtype}

\renewcommand{\thesection}{\arabic{section}}
\renewcommand{\thesubsection}{\thesection.\arabic{subsection}}
\renewcommand{\thesubsubsection}{\thesubsection.\arabic{subsubsection}}

\makeatletter
\def\thesectiondis{\thesection}
\def\thesubsectiondis{\thesubsection}
\def\thesubsubsectiondis{\thesubsubsection}
\makeatother

\usepackage[justification=centering]{caption}

\usepackage{titlesec}
\titleformat{\section}{\normalfont\Large\bfseries}{\thesection}{1em}{}
\titleformat{\subsection}{\normalfont\large\bfseries}{\thesubsection}{1em}{}

\usepackage{fancyhdr}
\usepackage{float}
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}

\fancyhead[L]{\small Information Engineering for Digital Medicine - Artificial Intelligence for Omics Data Analysis Course 2025-2026}

\fancyfoot[R]{\thepage}

\usepackage{booktabs}


% Your document starts here!
\begin{document}

\begin{titlepage}
    \centering
    \vspace*{\fill}
    {\Huge \textbf{Project Report} \par}
    \vspace{1.5cm}
    {\Large
    Marco Savastano \\
    Carmine Vardaro \par}
    \vspace{2cm}
    {\large Information Engineering for Digital Medicine \\ Artificial Intelligence for Omics Data Analysis Course 2025-2026 \par}
    \vspace*{\fill}
\end{titlepage}

\newpage
\thispagestyle{fancy}
\setcounter{page}{1}
\tableofcontents
\newpage

\thispagestyle{fancy}

\begin{abstract}
    The short abstract (50-80 words) is intended to give the reader an overview of the work.
\end{abstract}

\section{Introduction}

\subsection{Background Clinico}
Breve panoramica sulla patologia (CHD) e importanza di trovare nuovi biomarcatori non invasivi.

\subsection{La Metabolomica Untargeted}
Perché la LC-MS è la scelta giusta qui (visione olistica del fenotipo).

\subsection{Problematiche Aperte}
Qui introduci il "problema" del tuo progetto: la complessità dei dati, la necessità di integrare due modi di ionizzazione (ESI+/ESI-) e la scelta del miglior metodo di preprocessing (non esiste una "ricetta unica").

\subsection{Scopo del Lavoro}
Valutare e ottimizzare un workflow chemiometrico (dal preprocessing alla Data Fusion) per distinguere soggetti Sani vs Patologici e identificare le feature biologicamente rilevanti.

\section{Materials and Methods}

\subsection{Descrizione del Dataset}
The dataset is composed of metabolomic data acquired by LC–MS in both positive  (ESI+)  and  negative  (ESI-)  ionisation  mode.

There are no missing values and zeros, due to an value inputation phase already done focused on the replacement with one-fifth of the minimum value recorded in the dataset for that molecule.
\cite{CHD}

The following tables give an overview on the dataset composition, for both ESI+ and ESI- with the corresponding values:

	\begin{table}[H]
		\begin{center}
			\caption{ESI- Dataset Distribution and Characteristics}
			\label{tab:esi-dataset_details}
			\begin{tabular}{|l|c|}
				\hline
				\textbf{DESCRIPTION} & \textbf{VALUE} \\
				\hline
				Total Samples & 219 \\
				\hline
				Total Features (Metabolites) & 52 \\
				\hline
				Class Count: CTRL & 107 \\
				\hline
				Class Count: CHD & 104 \\
				\hline
				Class Count: QC & 8 \\
				\hline
				Samples with suffix '\_00' & 28 \\
				\hline
				Samples with suffix '\_01' (Tech Replicate) & 14 \\
				\hline
				Samples without suffix & 177 \\
				\hline
				Estimated Unique Biological Samples & 205 \\
				\hline
				CTRL - Biological Samples & 100 \\
				\hline
				CTRL - Technical Replicates & 7 \\
				\hline
				CHD - Biological Samples & 97 \\
				\hline
				CHD - Technical Replicates & 7 \\
				\hline
				QC - Total Samples & 8 \\
				\hline
				Negative Values Present & No \\
				\hline
			\end{tabular}
		\end{center}
	\end{table}
	
	
	\begin{table}[H]
		\begin{center}
			\caption{ESI+ Dataset Distribution and Characteristics}
			\label{tab:esi+dataset_details}
			\begin{tabular}{|l|c|}
				\hline
				\textbf{DESCRIPTION} & \textbf{VALUE} \\
				\hline
				Total Samples & 219 \\
				\hline
				Total Features (Metabolites) & 98 \\
				\hline
				Class Count: CTRL & 107 \\
				\hline
				Class Count: CHD & 104 \\
				\hline
				Class Count: QC & 8 \\
				\hline
				Samples with suffix '\_00' & 28 \\
				\hline
				Samples with suffix '\_01' (Tech Replicate) & 14 \\
				\hline
				Samples without suffix & 177 \\
				\hline
				Estimated Unique Biological Samples & 205 \\
				\hline
				CTRL - Biological Samples & 100 \\
				\hline
				CTRL - Technical Replicates & 7 \\
				\hline
				CHD - Biological Samples & 97 \\
				\hline
				CHD - Technical Replicates & 7 \\
				\hline
				QC - Total Samples & 8 \\
				\hline
				Negative Values Present & No \\
				\hline
			\end{tabular}
		\end{center}
	\end{table}

\subsection{Quality Assessment and Data Cleaning}

This preliminary phase is crucial to validate the technical quality of the experiment before proceeding with biological interpretation.

To this end, we monitored the behavior of Quality Control (QC) samples (pooled aliquots injected periodically) and technical replicates (samples analyzed in duplicate, denoted with suffixes \_00 and \_01).
The evaluation was performed using Principal Component Analysis (PCA) applied separately to the raw data of Negative (ESI-) and Positive (ESI+) ionization modes. Autoscaling was applied prior to PCA to ensure all metabolites contributed equally to the model, regardless of their absolute intensity.

PCA was employed as an unsupervised exploratory technique to visualize the intrinsic structure of the data variance. To facilitate the inspection of instrumental stability and technical reproducibility, specific sub-plots were generated from the same global PCA model to isolate QC samples and technical replicates. The results for the Negative and Positive ionization modes are presented in Figure \ref{fig:qa_neg} and Figure \ref{fig:qa_pos}, respectively.

\paragraph{Variance and Model Structure}
The Scree Plots (Fig. \ref{fig:qa_neg}c, \ref{fig:qa_pos}c) display the percentage of variance explained by each Principal Component (PC). The Loadings Plots (Fig. \ref{fig:qa_neg}b, \ref{fig:qa_pos}b) and Profiles (Fig. \ref{fig:qa_neg}d-e, \ref{fig:qa_pos}d-e) provide an overview of the features driving the separation.

\paragraph{Instrumental Stability (QC Analysis)}
The stability of the LC-MS system was evaluated by isolating the QC samples in the PCA space. As shown in the QC-specific score plots (Fig. \ref{fig:qa_neg}f, \ref{fig:qa_pos}f), only the QC samples are visualized to assess their compactness.
In the **Negative Ionization mode (ESI-)**, the QCs form a tight, well-defined cluster, indicating high instrumental stability.
In the **Positive Ionization mode (ESI+)**, the QCs show a slightly higher dispersion. This behavior is attributed to the inherent characteristics of Hydrophilic Interaction Liquid Chromatography (HILIC). The HILIC separation mechanism relies on a water-enriched layer on the stationary phase, making the partitioning equilibrium more sensitive to minor fluctuations in column conditioning compared to reversed-phase chromatography. However, despite this inherent dispersion, the QC cluster remains distinct from the biological variability.

\paragraph{Technical Reproducibility (Replicates Analysis)}
Reproducibility was assessed by projecting the technical replicates onto the PCA space (Fig. \ref{fig:qa_neg}g, \ref{fig:qa_pos}g). In these plots, non-replicated samples are hidden to highlight the distance between paired measurements (\_00 and \_01). In both ionization modes, the pairs of replicates are projected in close proximity, often overlapping, confirming that the analytical workflow yields consistent results for the same biological sample.

% FIGURE ESI NEGATIVE
\begin{figure*}[!hbt]
    \centering
    \setlength{\tabcolsep}{2pt}
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{ccc}
        % Row 1: Main Score and Loading (Large)
        \multicolumn{3}{c}{
            \includegraphics[width=0.48\textwidth]{../out/quality_assessment/pca/neg/pca_score_plot_PC1vsPC2.pdf} \hfill
            \includegraphics[width=0.48\textwidth]{../out/quality_assessment/pca/neg/pca_loading_plot_PC1vsPC2.pdf}
        } \\
        \multicolumn{3}{c}{\footnotesize (a) Global Score Plot (All Samples) \hspace{4cm} (b) Global Loading Plot} \\

        % Row 2: Scree and Profiles (Smaller)
        \includegraphics[width=0.32\textwidth]{../out/quality_assessment/pca/neg/pca_scree_plot.pdf} &
        \includegraphics[width=0.32\textwidth]{../out/quality_assessment/pca/neg/loading_profile_PC1.pdf} &
        \includegraphics[width=0.32\textwidth]{../out/quality_assessment/pca/neg/loading_profile_PC2.pdf} \\
        \footnotesize (c) Scree Plot & \footnotesize (d) Loading Profile PC1 & \footnotesize (e) Loading Profile PC2 \\

        % Row 3: QC Focus and Replicates Focus (Medium/Large)
        \multicolumn{3}{c}{
            \includegraphics[width=0.48\textwidth]{../out/quality_assessment/pca/neg/pca_score_plot_for_qc_PC1vsPC2.pdf} \hfill
            \includegraphics[width=0.48\textwidth]{../out/quality_assessment/pca/neg/pca_score_plot_for_replicates_PC1vsPC2.pdf}
        } \\
        \multicolumn{3}{c}{\footnotesize (f) Instrumental Stability (QC only) \hspace{4cm} (g) Reproducibility (Replicates only)} \\
    \end{tabular}
    \caption{\textbf{Quality Assessment for ESI- Dataset.} (a) Global PCA Score plot showing the distribution of all classes (CHD, CTRL, QC). (b) Loading plot showing feature contributions. (c-e) Variance analysis and loading profiles. (f) Zoom on QC samples: the tight cluster confirms high stability. (g) Zoom on technical replicates: paired samples show high overlap, confirming reproducibility.}
    \label{fig:qa_neg}
\end{figure*}

% FIGURE ESI POSITIVE
\begin{figure*}[!hbt]
    \centering
    \setlength{\tabcolsep}{2pt}
    \renewcommand{\arraystretch}{1.2}
    \begin{tabular}{ccc}
        % Row 1: Main Score and Loading
        \multicolumn{3}{c}{
            \includegraphics[width=0.48\textwidth]{../out/quality_assessment/pca/pos/pca_score_plot_PC1vsPC2.pdf} \hfill
            \includegraphics[width=0.48\textwidth]{../out/quality_assessment/pca/pos/pca_loading_plot_PC1vsPC2.pdf}
        } \\
        \multicolumn{3}{c}{\footnotesize (a) Global Score Plot (All Samples) \hspace{4cm} (b) Global Loading Plot} \\

        % Row 2: Scree and Profiles
        \includegraphics[width=0.32\textwidth]{../out/quality_assessment/pca/pos/pca_scree_plot.pdf} &
        \includegraphics[width=0.32\textwidth]{../out/quality_assessment/pca/pos/loading_profile_PC1.pdf} &
        \includegraphics[width=0.32\textwidth]{../out/quality_assessment/pca/pos/loading_profile_PC2.pdf} \\
        \footnotesize (c) Scree Plot & \footnotesize (d) Loading Profile PC1 & \footnotesize (e) Loading Profile PC2 \\

        % Row 3: QC Focus and Replicates Focus
        \multicolumn{3}{c}{
            \includegraphics[width=0.48\textwidth]{../out/quality_assessment/pca/pos/pca_score_plot_for_qc_PC1vsPC2.pdf} \hfill
            \includegraphics[width=0.48\textwidth]{../out/quality_assessment/pca/pos/pca_score_plot_for_replicates_PC1vsPC2.pdf}
        } \\
        \multicolumn{3}{c}{\footnotesize (f) Instrumental Stability (QC only) \hspace{4cm} (g) Reproducibility (Replicates only)} \\
    \end{tabular}
    \caption{\textbf{Quality Assessment for ESI+ Dataset.} (a-b) Global PCA model overview. (c-e) Variance and Loadings. (f) Stability check: QCs show a wider dispersion compared to negative mode, consistent with HILIC sensitivity, but remain distinct from biological variance. (g) Reproducibility check showing paired replicates.}
    \label{fig:qa_pos}
\end{figure*}

Having confirmed the technical robustness of the experiment, specific data cleaning steps were implemented to prepare the dataset for biological modeling.

\paragraph{Removal of Quality Control Samples}
QC samples were removed from the final dataset as they have fulfilled their purpose of monitoring instrumental stability. Retaining QCs in downstream supervised analysis (e.g., PLS-DA) would introduce an artificial class that does not reflect a biological phenotype. Furthermore, due to their chemical homogeneity, QCs would form a dense cluster accounting for a large portion of the total variance, potentially masking the subtler biological differences between CHD and CTRL groups.

\paragraph{Removal of Technical Duplicates}
To ensure the statistical independence of observations, technical duplicates were handled by retaining only one measurement per biological subject (samples with suffix \_00). Including both replicates would violate the assumption of independence required by most statistical tests, artificially inflating the sample size and underestimating the intra-class variance. As duplicates were not available for all samples, averaging was avoided to prevent inconsistency in the data structure. Therefore, the removal of the second replicate (\_01) ensures a homogeneous dataset where each sample represents a unique biological entity.

\subsection{Data Pre-Processing}

\subsubsection{Data Normalization}

The LC-MS untargeted analysis of biological fluids is inherently subject to systematic variations unrelated to the biological problem, such as differences in sample dilution (e.g., hydration status of the subjects) and fluctuations in ionization efficiency. As evidenced by the raw data distribution (Fig. \ref{fig:norm_neg}a and Fig. \ref{fig:norm_pos}a), a significant variability in the median intensity across samples was observed, necessitating a normalization step to render the samples comparable.

We evaluated multiple normalization strategies, ranging from global intensity corrections (TIC, Mean, Median) to distribution-based methods (Quantile) and robust probabilistic approaches (Probabilistic Quotient Normalization - PQN). The selection of the optimal method was driven by a dual criterion: (i) qualitative inspection of sample distributions via boxplots, and (ii) quantitative assessment of the Coefficient of Variation (CV\%) calculated on the technical replicates and across the biological groups.

Figures \ref{fig:norm_neg} and \ref{fig:norm_pos} illustrate the effect of selected normalization algorithms on the Negative (ESI-) and Positive (ESI+) datasets, respectively.
While the raw data showed pronounced "batch-like" or dilution-related fluctuations, all normalization methods improved the alignment of sample medians. Specifically:
\begin{itemize}
    \item \textbf{Total Ion Current (TIC):} Provided a standard correction based on the total signal sum, effectively reducing global differences but potentially sensitive to high-intensity artifacts.
    \item \textbf{Quantile Normalization:} Resulted in perfectly aligned distributions (Fig. \ref{fig:norm_neg}c, \ref{fig:norm_pos}c). However, visual inspection suggests this approach may be overly aggressive, forcing all samples to conform to an identical distribution and potentially suppressing genuine biological heterogeneity.
    \item \textbf{Probabilistic Quotient Normalization (PQN):} Demonstrated a robust alignment of medians and interquartile ranges (Fig. \ref{fig:norm_neg}d, \ref{fig:norm_pos}d) without imposing the artificial uniformity observed with Quantile normalization.
\end{itemize}

To objectively quantify the reduction in technical variance, the median Coefficient of Variation (CV\%) was calculated for all features across the Control (CTRL) and Disease (CHD) groups. The results are summarized in Table \ref{tab:cv_neg} and Table \ref{tab:cv_pos}.

In both ionization modes, the absence of normalization yielded the highest variability (Avg CV $\approx$ 58\% for ESI- and 68\% for ESI+).
Consistent with the visual inspection, \textbf{Quantile normalization} achieved the lowest numerical CV values (Avg CV $\approx$ 50\% and 57\%, respectively). However, minimal variance is not solely indicative of data quality; it may also reflect overfitting and loss of biological signal.
\textbf{PQN} consistently ranked among the top performing methods, achieving a substantial reduction in variance (Avg CV $\approx$ 51.5\% for ESI- and 59.7\% for ESI+) comparable to Quantile and Median normalization, while theoretically preserving the relative abundance ratios of metabolites better than global sum methods.

Based on the combined evidence, \textbf{PQN (Probabilistic Quotient Normalization)} was selected as the optimal strategy for this study. It provides the best trade-off between the reduction of systematic error (comparable to the most aggressive methods) and the preservation of biological variance required for the subsequent biomarker discovery phase.

% --- TABLE CV NEGATIVE (Sorted by Performance) ---
\begin{table}[!hbt]
\centering
\caption{Comparison of Normalization Methods by Coefficient of Variation (CV\%) - ESI Negative Dataset.}
\label{tab:cv_neg}
\begin{tabular}{lccc}
\toprule
\textbf{Normalization} & \textbf{Median CV} & \textbf{Median CV} & \textbf{Average} \\
\textbf{Method} & \textbf{CTRL (\%)} & \textbf{CHD (\%)} & \textbf{CV (\%)} \\
\midrule
Quantile & 45.46 & 55.10 & 50.28 \\
\textbf{PQN} & \textbf{44.94} & \textbf{58.06} & \textbf{51.50} \\
Mean / TIC & 45.91 & 59.66 & 52.79 \\
Median & 45.48 & 63.94 & 54.71 \\
Range / Max & 51.28 & 63.22 & 57.25 \\
None (Raw) & 49.11 & 67.40 & 58.26 \\
\bottomrule
\end{tabular}
\end{table}

% --- TABLE CV POSITIVE (Sorted by Performance) ---
\begin{table}[!hbt]
\centering
\caption{Comparison of Normalization Methods by Coefficient of Variation (CV\%) - ESI Positive Dataset.}
\label{tab:cv_pos}
\begin{tabular}{lccc}
\toprule
\textbf{Normalization} & \textbf{Median CV} & \textbf{Median CV} & \textbf{Average} \\
\textbf{Method} & \textbf{CTRL (\%)} & \textbf{CHD (\%)} & \textbf{CV (\%)} \\
\midrule
Quantile & 53.35 & 61.62 & 57.48 \\
Median & 54.48 & 60.69 & 57.58 \\
Range / Max & 53.84 & 64.46 & 59.15 \\
\textbf{PQN} & \textbf{56.12} & \textbf{63.38} & \textbf{59.75} \\
Mean / TIC & 54.44 & 65.09 & 59.77 \\
None (Raw) & 58.43 & 77.84 & 68.14 \\
\bottomrule
\end{tabular}
\end{table}

% --- FIGURE ESI NEGATIVE NORMALIZATION ---
\begin{figure}[!hbt]
    \centering
    \setlength{\tabcolsep}{1pt}
    \renewcommand{\arraystretch}{0.5}
    \begin{tabular}{c}
        % (a) No Normalization
        \includegraphics[width=0.7\columnwidth]{../out/pre_processing/neg/normalization/no_norm_page1.pdf} \\
        \footnotesize (a) Raw Data (No Normalization) \\
        \vspace{0.2cm} % Spazio verticale tra i grafici

        % (b) TIC
        \includegraphics[width=0.7\columnwidth]{../out/pre_processing/neg/normalization/tic_page1.pdf} \\
        \footnotesize (b) Total Ion Current (TIC) Normalization \\
        \vspace{0.2cm}

        % (c) Quantile
        \includegraphics[width=0.7\columnwidth]{../out/pre_processing/neg/normalization/quantile_page1.pdf} \\
        \footnotesize (c) Quantile Normalization \\
        \vspace{0.2cm}

        % (d) PQN
        \includegraphics[width=0.7\columnwidth]{../out/pre_processing/neg/normalization/pqn_page1.pdf} \\
        \footnotesize (d) Probabilistic Quotient Normalization (PQN)
    \end{tabular}
    \caption{\textbf{Comparison of Normalization Strategies for ESI- Dataset.}
    Boxplots representing the global intensity distribution of all samples.
    (a) Raw data showing significant systematic variation (e.g., dilution effects).
    (b) TIC normalization, acting on the total sum.
    (c) Quantile normalization, forcing identical distributions potentially suppressing biological signal.
    (d) PQN, the selected method, which effectively reduces technical variance while preserving biological information.}
    \label{fig:norm_neg}
\end{figure}

\newpage

% --- FIGURE ESI POSITIVE NORMALIZATION ---
\begin{figure}[!hbt]
    \centering
    \setlength{\tabcolsep}{1pt}
    \renewcommand{\arraystretch}{0.5}
    \begin{tabular}{c}
        % (a) No Normalization
        \includegraphics[width=0.7\columnwidth]{../out/pre_processing/pos/normalization/no_norm_page1.pdf} \\
        \footnotesize (a) Raw Data (No Normalization) \\
        \vspace{0.2cm}

        % (b) TIC
        \includegraphics[width=0.7\columnwidth]{../out/pre_processing/pos/normalization/tic_page1.pdf} \\
        \footnotesize (b) Total Ion Current (TIC) Normalization \\
        \vspace{0.2cm}

        % (c) Quantile
        \includegraphics[width=0.7\columnwidth]{../out/pre_processing/pos/normalization/quantile_page1.pdf} \\
        \footnotesize (c) Quantile Normalization \\
        \vspace{0.2cm}

        % (d) PQN
        \includegraphics[width=0.7\columnwidth]{../out/pre_processing/pos/normalization/pqn_page1.pdf} \\
        \footnotesize (d) Probabilistic Quotient Normalization (PQN)
    \end{tabular}
    \caption{\textbf{Comparison of Normalization Strategies for ESI+ Dataset.}
    (a) Raw data distribution.
    (b) TIC normalization results.
    (c) Quantile normalization results showing aggressive distribution alignment.
    (d) PQN results, selected as the optimal compromise for downstream analysis.}
    \label{fig:norm_pos}
\end{figure}

\subsubsection{Data Transformation}

Following the assessment of normalization strategies, the distribution of the intensity values was evaluated to satisfy the assumptions of normality required by multivariate statistical methods (e.g., PCA, PLS-DA) and parametric univariate tests (e.g., t-test).
LC-MS metabolomics data typically exhibit a right-skewed distribution, where the majority of signals have low intensity, while a few highly abundant metabolites stretch the dynamic range, potentially dominating the variance.

We evaluated different variance-stabilizing transformations, including power transformations (Square Root, Cube Root) and logarithmic transformations (Log2, Natural Logarithm, Log10).
Visual inspection of the global density plots revealed that power transformations were insufficient to correct the skewness of the distributions (data not shown). Conversely, all logarithmic transformations effectively compressed the high-intensity values and expanded the low-intensity range, resulting in a distribution approximating a Gaussian curve.

Since Log2, Ln, and Log10 produced equivalent distributional shapes differing only in scale, \textbf{Log10 transformation} was selected as the standard method for this study. This transformation is widely accepted in mass spectrometry as it renders orders of magnitude easily interpretable while effectively symmetrizing the data distribution.

Figure \ref{fig:transf_neg} and Figure \ref{fig:transf_pos} illustrate the comparative analysis between the non-transformed data and the Log10-transformed data for the ESI- and ESI+ datasets, respectively. In the transformed data, the empirical density (solid line) shows a significant overlap with the theoretical Gaussian distribution (dashed line), confirming the efficacy of the transformation.

\begin{figure}[!hbt]
    \centering
    \setlength{\tabcolsep}{2pt}
    \begin{tabular}{cc}
        \includegraphics[width=0.48\columnwidth]{../out/pre_processing/neg/transformation/no_transf.pdf} &
        \includegraphics[width=0.48\columnwidth]{../out/pre_processing/neg/transformation/log_10.pdf} \\
        \footnotesize (a) Original Distribution (Skewed) & \footnotesize (b) After Log10 Transformation
    \end{tabular}
    \caption{\textbf{Effect of Log10 Transformation on ESI- Dataset.}
    Global density plots pooling all feature intensities.
    (a) The original data distribution is highly right-skewed, deviating significantly from the theoretical normal distribution (dashed line).
    (b) Log10 transformation successfully centers the distribution, achieving a Gaussian-like shape suitable for multivariate analysis.}
    \label{fig:transf_neg}
\end{figure}

\begin{figure}[!hbt]
    \centering
    \setlength{\tabcolsep}{2pt}
    \begin{tabular}{cc}
        \includegraphics[width=0.48\columnwidth]{../out/pre_processing/pos/transformation/no_transf.pdf} &
        \includegraphics[width=0.48\columnwidth]{../out/pre_processing/pos/transformation/log_10.pdf} \\
        \footnotesize (a) Original Distribution (Skewed) & \footnotesize (b) After Log10 Transformation
    \end{tabular}
    \caption{\textbf{Effect of Log10 Transformation on ESI+ Dataset.}
    (a) The raw positive mode data exhibits a pronounced right-skewness.
    (b) Log10 transformation corrects the skewness, aligning the empirical density (solid line) with the theoretical Gaussian curve (dashed line).}
    \label{fig:transf_pos}
\end{figure}

\subsubsection{Data Scaling}

The final step of the pre-processing pipeline involved data scaling. In metabolomics, metabolite intensities can span several orders of magnitude. Without proper scaling, variables with high abundance and large variance would naturally dominate multivariate models based on variance maximization (e.g., PCA), biasing the results and potentially masking significant biological variations present in low-abundance metabolites.

To address this issue, **Autoscaling** (Unit Variance Scaling) was applied to the normalized and transformed data. This method involves mean-centering each variable and dividing it by its standard deviation. As a result, all metabolites are scaled to have a mean of zero and a standard deviation of one, ensuring that each feature contributes equally to the statistical model regardless of its absolute concentration.

Figure \ref{fig:scale_neg} and Figure \ref{fig:scale_pos} demonstrate the effect of autoscaling on the feature distributions for ESI- and ESI+ datasets, respectively. Before scaling (Panel a), the variables exhibit disparate ranges of intensity. After autoscaling (Panel b), all features are comparable, centered around zero with standardized variance, making the dataset suitable for unsupervised and supervised modeling.

% --- FIGURE ESI NEGATIVE SCALING ---
\begin{figure}[!hbt]
    \centering
    \setlength{\tabcolsep}{1pt}
    \renewcommand{\arraystretch}{0.5}
    \begin{tabular}{c}
        % (a) No Scaling
        \includegraphics[width=0.9\columnwidth]{../out/pre_processing/neg/scaling/no_autoscaling_page1.pdf} \\
        \footnotesize (a) Before Scaling (Variable Intensities) \\
        \vspace{0.2cm}

        % (b) With Autoscaling
        \includegraphics[width=0.9\columnwidth]{../out/pre_processing/neg/scaling/with_autoscaling_page1.pdf} \\
        \footnotesize (b) After Autoscaling (Unit Variance)
    \end{tabular}
    \caption{\textbf{Effect of Autoscaling on ESI- Features.}
    Boxplots representing the distribution of individual metabolites (features).
    (a) Original features show highly variable ranges and variances.
    (b) After autoscaling, all features are mean-centered with unit variance, ensuring equal weight in multivariate analysis.}
    \label{fig:scale_neg}
\end{figure}

% --- FIGURE ESI POSITIVE SCALING ---
\begin{figure}[!hbt]
    \centering
    \setlength{\tabcolsep}{1pt}
    \renewcommand{\arraystretch}{0.5}
    \begin{tabular}{c}
        % (a) No Scaling
        \includegraphics[width=0.9\columnwidth]{../out/pre_processing/pos/scaling/no_autoscaling_page1.pdf} \\
        \footnotesize (a) Before Scaling (Variable Intensities) \\
        \vspace{0.2cm}

        % (b) With Autoscaling
        \includegraphics[width=0.9\columnwidth]{../out/pre_processing/pos/scaling/with_autoscaling_page1.pdf} \\
        \footnotesize (b) After Autoscaling (Unit Variance)
    \end{tabular}
    \caption{\textbf{Effect of Autoscaling on ESI+ Features.}
    (a) The disparate scales of metabolite intensities in the positive mode.
    (b) The homogenized feature space achieved through autoscaling.}
    \label{fig:scale_pos}
\end{figure}

\subsection{Anomaly Detection}
Descrizione del metodo usato per identificare e rimuovere gli outlier (fondamentale per la pulizia del dato).

\subsection{Feature Selection}
Metodi statistici/algoritmici utilizzati per ridurre la dimensionalità e rimuovere il rumore prima del modeling.

\subsection{Strategie di Data Fusion}
Definizione degli approcci: Low-Level (concatenazione semplice) vs High-Level (o altri approcci). L'obiettivo è sfruttare la complementarità ESI+/ESI-.

\subsection{Analisi Statistica e Machine Learning}
\begin{itemize}
    \item \textbf{Unsupervised:} PCA (per l'esplorazione).
    \item \textbf{Supervised:} PLS-DA, SVM, Random Forest, Logistic Regression.
    \item \textbf{Validazione:} Descrizione rigorosa dello split Training Set vs Validation Set (o Cross-Validation) per evitare l'overfitting.
\end{itemize}

\subsection{Stack Tecnologico}
Breve paragrafo sulle librerie Python utilizzate (Pandas, Scikit-learn, ecc.) per garantire la riproducibilità.

\section{Results and Discussion}

\subsection{Valutazione dell'Analisi Esplorativa (PCA)}
Visualizzazione dei dati ESI+ e ESI- separati. Valutazione degli Outlier (prima e dopo la rimozione). Confronto delle tecniche di scaling (es. efficacia dell'autoscaling).

\subsection{Performance dei Modelli su Singoli Dataset (ESI+ / ESI-)}
Confronto delle metriche (Accuratezza, Specificità, Sensibilità) tra PLS-DA, SVM, RF, LR. Quale modello performa meglio sui dati positivi? E sui negativi?

\subsection{Risultati della Data Fusion}
La fusione dei dati ha migliorato la classificazione rispetto ai dataset singoli?

\subsection{Interpretabilità e Biomarcatori (Feature Importance)}
Analisi delle Feature Importances e Analisi Univariata (Volcano Plot). Identificazione/interpretazione biologica dei top-metaboliti.


\section{Conclusions}
Sintesi del miglior workflow identificato. Considerazioni sull'interpretabilità biologica e limiti dello studio (es. numero di campioni, assenza di validazione esterna).


% Now we need a bibliography:
\begin{thebibliography}{5}

	%Each item starts with a \bibitem{reference} command and the details thereafter.
	\bibitem{CHD} % Transaction paper
	Mires, Stuart, et al. "Plasma metabolomic and lipidomic profiles accurately classify mothers of children with congenital heart disease: an observational study." Metabolomics 20.4 (2024): 70.

\end{thebibliography}

	% This is how you define a table: the [!hbt] means that LaTeX is forced (by the !) to place the table exactly here (by h), or if that doesnt work because of a pagebreak or so, it tries to place the table to the bottom of the page (by b) or the top (by t).
	\begin{table}[!hbt]
		% Center the table
		\begin{center}
		% Title of the table
		\caption{Simulation Parameters}
		\label{tab:simParameters}
		% Table itself: here we have two columns which are centered and have lines to the left, right and in the middle: |c|c|
		\begin{tabular}{|c|c|}
			% To create a horizontal line, type \hline
			\hline
			% To end a column type &
			% For a linebreak type \\
			Information message length & $k=16000$ bit \\
			\hline
			Radio segment size & $b=160$ bit \\
			\hline
			Rate of component codes & $R_{cc}=1/3$\\
			\hline
			Polynomial of component encoders & $[1 , 33/37 , 25/37]_8$\\
			\hline
		\end{tabular}
		\end{center}
	\end{table}


% Your document ends here!
\end{document}